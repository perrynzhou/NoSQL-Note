## 分布式系统数据分布策略





- 分布式系统中数据分布策略有两种
  - 节点取余分策略，使用特定数据X，在结合一个哈希函数hash,在根据集群内阶段树N，使用公式:hash(X)%N 计算出哈希值，用来决定数据映射到哪个数据节点上。这种方案有一种问题，当添加或者删除节点时候，数据节点映射关系改变了，会导致数据的重新迁移。这种方案一般用于数据库分库分表规则,一般采用预分区的方式，提前根据数据量规划好分区数.
  - 一致性哈希策略，首先每个节点分配一个token,token的范围一般在0到2的32次方减一范围之内，每个节点的token构成一个哈希环,数据读写执行节点查找操作时候，先根据key计算出哈希值,然后顺时针找到第一个大于等于该token的节点，数据从该节点读取或者写入。这种方案也存在一些问题,加减节点导致有些数据无法命中、当使用少量节点时候，节点变化将大范围影响哈希环中数据映射，因此这种方案不适合少量节点的方案
  - 虚拟槽分区策略，虚拟槽分区巧妙使用了哈希空间，使用分散度良好的哈希函数把所有数据映射到一个固定范围的整数集合中,整数定义为槽,这个范围远远大于节点数。比如Redis Cluster槽范围是0~16383，槽是集群内数据管理和迁移的基本单位,采用大范围槽目的是方便进行数据拆分和集群扩展，每个节点会负责一定数量的槽